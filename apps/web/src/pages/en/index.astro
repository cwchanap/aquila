---
import MainLayout from '../../layouts/main.astro';
// Component Imports
import MainMenu from '../../components/MainMenu.svelte';
import { t as translate } from '../../lib/utils';

const locale = Astro.currentLocale || 'en';
const t = (key: string) => translate(locale, key);
---

<MainLayout title={t("menu.title")}>
	<MainMenu client:load locale={Astro.currentLocale || 'en'} />

	<script>
		// Handle language preference persistence
		document.addEventListener('DOMContentLoaded', () => {
			// Check if we're on the root path
			if (window.location.pathname === '/') {
				// Check for saved language preference
				const savedLanguage = localStorage.getItem('aquila:language');

				// If user has a Chinese preference and we're not already on Chinese, redirect
				if (savedLanguage === 'zh' && !window.location.pathname.startsWith('/zh')) {
					window.location.href = '/zh';
					return;
				}

				// If user has English preference and we're on Chinese, redirect to English
				if (savedLanguage === 'en' && window.location.pathname.startsWith('/zh')) {
					window.location.href = '/';
					return;
				}
			}
		});
	</script>
</MainLayout>
