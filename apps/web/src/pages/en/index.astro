---
import MainLayout from '../../layouts/main.astro';
// Component Imports
import MainMenu from '../../components/MainMenu.astro';
import en from '@aquila/dialogue/translations/en.json';
import zh from '@aquila/dialogue/translations/zh.json';

// Helper function to get translations
const t = (key: string): string => {
  const locale = Astro.currentLocale || 'en';
  const keys = key.split('.');
  let value: Record<string, unknown> = locale === 'zh' ? zh : en;

  for (const k of keys) {
    if (value && typeof value === 'object' && k in value) {
      value = value[k] as Record<string, unknown>;
    } else {
      return key;
    }
  }

  return typeof value === 'string' ? value : key;
};

// Full Astro Component Syntax:
// https://docs.astro.build/basics/astro-components/
---

<MainLayout title={t("menu.title")}>
	<MainMenu />

	<script>
		// Handle language preference persistence
		document.addEventListener('DOMContentLoaded', () => {
			// Check if we're on the root path
			if (window.location.pathname === '/') {
				// Check for saved language preference
				const savedLanguage = localStorage.getItem('aquila:language');

				// If user has a Chinese preference and we're not already on Chinese, redirect
				if (savedLanguage === 'zh' && !window.location.pathname.startsWith('/zh')) {
					window.location.href = '/zh';
					return;
				}

				// If user has English preference and we're on Chinese, redirect to English
				if (savedLanguage === 'en' && window.location.pathname.startsWith('/zh')) {
					window.location.href = '/';
					return;
				}
			}
		});
	</script>
</MainLayout>
