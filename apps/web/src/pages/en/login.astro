---
import MainLayout from '../../layouts/main.astro';

// No server-side form handling needed with better-auth
---

<MainLayout title="Login - Game App">
		<!-- Ocean Background with animated waves -->
		<div class="min-h-screen relative overflow-hidden" data-locale={Astro.currentLocale || 'en'}>
			<!-- Gradient Ocean Background -->
			<div class="absolute inset-0 bg-linear-to-b from-sky-200 via-sky-300 to-blue-400"></div>

			<!-- Animated Ocean Waves (Background Layer) -->
			<div class="absolute inset-0">
				<svg class="absolute bottom-0 w-full h-96" viewBox="0 0 1440 320" preserveAspectRatio="none">
					<path fill="rgba(59, 130, 246, 0.3)" fill-opacity="1"
						d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,112C672,96,768,96,864,112C960,128,1056,160,1152,160C1248,160,1344,128,1392,112L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z">
						<animateTransform
							attributeName="transform"
							type="translate"
							values="0 0; 50 0; 0 0"
							dur="6s"
							repeatCount="indefinite"
						/>
					</path>
				</svg>

				<svg class="absolute bottom-0 w-full h-80" viewBox="0 0 1440 320" preserveAspectRatio="none">
					<path fill="rgba(59, 130, 246, 0.4)" fill-opacity="1"
						d="M0,192L48,176C96,160,192,128,288,128C384,128,480,160,576,176C672,192,768,192,864,176C960,160,1056,128,1152,128C1248,128,1344,160,1392,176L1440,192L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z">
						<animateTransform
							attributeName="transform"
							type="translate"
							values="0 0; -30 0; 0 0"
							dur="8s"
							repeatCount="indefinite"
						/>
					</path>
				</svg>

				<svg class="absolute bottom-0 w-full h-64" viewBox="0 0 1440 320" preserveAspectRatio="none">
					<path fill="rgba(59, 130, 246, 0.6)" fill-opacity="1"
						d="M0,256L48,240C96,224,192,192,288,192C384,192,480,224,576,240C672,256,768,256,864,240C960,224,1056,192,1152,192C1248,192,1344,224,1392,240L1440,256L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z">
						<animateTransform
							attributeName="transform"
							type="translate"
							values="0 0; 40 0; 0 0"
							dur="10s"
							repeatCount="indefinite"
						/>
					</path>
				</svg>
			</div>

			<!-- Subtle cloud shadows -->
			<div class="absolute inset-0 opacity-20">
				<div class="absolute top-20 left-1/4 w-32 h-16 bg-white rounded-full blur-xl animate-pulse"></div>
				<div class="absolute top-32 right-1/3 w-24 h-12 bg-white rounded-full blur-xl animate-pulse" style="animation-delay: 2s;"></div>
				<div class="absolute top-16 right-1/4 w-28 h-14 bg-white rounded-full blur-xl animate-pulse" style="animation-delay: 4s;"></div>
			</div>

			<!-- Back button - Gaming Style -->
			<a
				href={`/${Astro.currentLocale || 'en'}/`}
				class="absolute top-6 left-6 p-4 bg-white/80 hover:bg-white/90 text-slate-700 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:scale-110 hover:-translate-y-1 border-2 border-white/60 backdrop-blur-sm z-20"
				style="font-family: 'Orbitron', monospace;"
			>
				<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7" />
				</svg>
			</a>

			<!-- Main Content Container - Gaming Visual Novel Style -->
			<div class="min-h-screen flex items-center justify-center relative">
				<div class="bg-white/90 backdrop-blur-md rounded-3xl p-10 shadow-2xl border border-white/50 max-w-lg w-full mx-6 transform hover:scale-[1.02] transition-all duration-500">
					<!-- Title with Gaming-inspired styling -->
					<div class="text-center mb-12">
						<h1 class="text-5xl font-black mb-4 tracking-wider uppercase bg-linear-to-r from-blue-600 via-cyan-500 to-blue-600 bg-clip-text text-transparent drop-shadow-lg" style="font-family: 'Orbitron', 'Exo 2', 'Rajdhani', monospace, sans-serif; text-shadow: 0 0 20px rgba(59, 130, 246, 0.3);">
							Login
						</h1>
						<div class="w-24 h-1 bg-linear-to-r from-transparent via-cyan-400 to-transparent mx-auto rounded-full animate-pulse"></div>
						<div class="text-sm font-semibold text-slate-600 mt-2 tracking-widest uppercase opacity-70" style="font-family: 'Orbitron', monospace;">
							Access Your Adventure
						</div>
					</div>

					<form id="login-form" class="space-y-6">
						<div>
							<label for="email" class="block text-slate-700 font-bold mb-3 tracking-wide" style="font-family: 'Orbitron', monospace;">
								Email
							</label>
							<input
								type="email"
								id="email"
								name="email"
								required
								class="w-full py-4 px-5 bg-white/70 text-slate-800 placeholder-slate-500 rounded-2xl border-2 border-slate-300/60 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-cyan-400/50 focus:border-cyan-400/50 transition-all duration-300 shadow-lg"
								placeholder="Enter your email"
								style="font-family: 'Exo 2', sans-serif;"
							/>
						</div>

						<div>
							<label for="password" class="block text-slate-700 font-bold mb-3 tracking-wide" style="font-family: 'Orbitron', monospace;">
								Password
							</label>
							<input
								type="password"
								id="password"
								name="password"
								required
								class="w-full py-4 px-5 bg-white/70 text-slate-800 placeholder-slate-500 rounded-2xl border-2 border-slate-300/60 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-cyan-400/50 focus:border-cyan-400/50 transition-all duration-300 shadow-lg"
								placeholder="Enter your password"
								style="font-family: 'Exo 2', sans-serif;"
							/>
						</div>

						<button
							type="submit"
							class="group relative w-full py-6 px-8 bg-linear-to-r from-blue-500 via-cyan-400 to-blue-500 hover:from-blue-600 hover:via-cyan-500 hover:to-blue-600 text-white font-bold rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:scale-[1.05] hover:-translate-y-2 border-2 border-cyan-300/50 overflow-hidden"
							style="font-family: 'Orbitron', 'Exo 2', monospace; text-shadow: 0 2px 4px rgba(0,0,0,0.3);"
						>
							<!-- Button glow effect -->
							<div class="absolute inset-0 bg-linear-to-r from-transparent via-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 animate-pulse"></div>
							<span class="relative text-xl tracking-wider uppercase font-black">Login</span>
							<!-- Gaming accent corners -->
							<div class="absolute top-1 left-1 w-3 h-3 border-t-2 border-l-2 border-white/60"></div>
							<div class="absolute top-1 right-1 w-3 h-3 border-t-2 border-r-2 border-white/60"></div>
							<div class="absolute bottom-1 left-1 w-3 h-3 border-b-2 border-l-2 border-white/60"></div>
							<div class="absolute bottom-1 right-1 w-3 h-3 border-b-2 border-r-2 border-white/60"></div>
						</button>

						<div class="mt-8 text-center">
							<p class="text-slate-600 text-sm" style="font-family: 'Exo 2', sans-serif;">
								Don't have an account?
								<a
									href={`/${Astro.currentLocale || 'en'}/signup`}
									class="text-blue-600 font-bold hover:text-cyan-500 underline ml-1 transition-colors duration-300"
									style="font-family: 'Orbitron', monospace;"
								>
									Sign up here
								</a>
							</p>
							<p class="text-slate-600 text-sm mt-3" style="font-family: 'Exo 2', sans-serif;">
								<a
									id="forgot-password"
									href="#"
									class="text-blue-600 font-bold hover:text-cyan-500 underline transition-colors duration-300"
									style="font-family: 'Orbitron', monospace;"
								>
									Forgot your password?
								</a>
							</p>
						</div>
					</form>

					<div id="error-message" class="mt-4 text-red-600 text-sm font-semibold hidden p-3 bg-red-100 rounded-lg border border-red-300"></div>
					<div id="success-message" class="mt-2 text-green-700 text-sm font-semibold hidden p-3 bg-green-100 rounded-lg border border-green-300"></div>

					<!-- Gaming Decorative Elements -->
					<div class="mt-10 flex justify-center items-center space-x-4 opacity-60">
						<!-- Power indicator bars -->
						<div class="flex space-x-1">
							<div class="w-1 h-2 bg-cyan-400 rounded-sm animate-pulse"></div>
							<div class="w-1 h-3 bg-blue-400 rounded-sm animate-pulse" style="animation-delay: 0.2s;"></div>
							<div class="w-1 h-2 bg-cyan-400 rounded-sm animate-pulse" style="animation-delay: 0.4s;"></div>
						</div>

						<!-- Gaming hexagon (smaller) -->
						<div class="relative">
							<div class="w-4 h-4 bg-linear-to-r from-blue-400 to-cyan-400 transform rotate-45 animate-spin" style="animation-duration: 8s; clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);"></div>
							<div class="absolute inset-0 w-4 h-4 bg-white/30 transform rotate-45" style="clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);"></div>
						</div>

						<!-- Power indicator bars (mirrored) -->
						<div class="flex space-x-1">
							<div class="w-1 h-2 bg-cyan-400 rounded-sm animate-pulse" style="animation-delay: 0.6s;"></div>
							<div class="w-1 h-3 bg-blue-400 rounded-sm animate-pulse" style="animation-delay: 0.4s;"></div>
							<div class="w-1 h-2 bg-cyan-400 rounded-sm animate-pulse" style="animation-delay: 0.2s;"></div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script>
			import { getSupabaseAuthClient } from '@/lib/auth';
			
			document.addEventListener('DOMContentLoaded', () => {
				const loginForm = document.getElementById('login-form') as HTMLFormElement | null;
				const errorMessage = document.getElementById('error-message');
				const successMessage = document.getElementById('success-message');
				const forgotPassword = document.getElementById('forgot-password');
			
				if (!loginForm || !errorMessage || !successMessage) {
					return;
				}
			
				const errorEl = errorMessage as HTMLElement;
				const successEl = successMessage as HTMLElement;
				const supabase = getSupabaseAuthClient();
			
				function showError(message: string) {
					errorEl.textContent = message;
					errorEl.classList.remove('hidden');
				}
			
				function hideError() {
					errorEl.classList.add('hidden');
				}

				function showSuccess(message: string) {
					successEl.textContent = message;
					successEl.classList.remove('hidden');
				}

				function hideSuccess() {
					successEl.classList.add('hidden');
				}
			
				loginForm.addEventListener('submit', async (e) => {
					e.preventDefault();
					hideError();
					hideSuccess();
				
					const formData = new FormData(loginForm);
					const email = formData.get('email')?.toString() ?? '';
					const password = formData.get('password')?.toString() ?? '';
				
					if (!email || !password) {
						showError('Invalid credentials');
						return;
					}
				
					try {
						const { error } = await supabase.auth.signInWithPassword({
							email,
							password,
						});
						
						if (error) {
							showError(error.message || 'Invalid credentials');
							return;
						}
					
						const locale =
							document
								.querySelector('[data-locale]')
								?.getAttribute('data-locale') || 'en';
						window.location.href = `/${locale}/`;
					} catch (error) {
						console.error('Login failed:', error);
						showError('Invalid credentials');
					}
				});

				forgotPassword?.addEventListener('click', async (e) => {
					e.preventDefault();
					hideError();
					hideSuccess();

					const formData = new FormData(loginForm);
					const email = formData.get('email')?.toString() ?? '';

					if (!email) {
						showError('Please enter your email to reset your password.');
						return;
					}

					try {
						const locale =
							document
								.querySelector('[data-locale]')
								?.getAttribute('data-locale') || 'en';
						const redirectTo = new URL(`/${locale}/reset`, window.location.origin).toString();
						const { error } = await supabase.auth.resetPasswordForEmail(email, {
							redirectTo,
						});

						if (error) {
							showError(error.message || 'We could not send the reset email. Please try again.');
							return;
						}

						showSuccess('Password reset email sent. Check your inbox.');
					} catch (err) {
						console.error('Reset email error:', err);
						showError('We could not send the reset email. Please try again.');
					}
				});
			});
		</script>
	</MainLayout>
