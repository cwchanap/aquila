---
import '@/styles/global.css';
import { SimpleAuthService } from '@/lib/simple-auth.js';

// Check if user is authenticated
const sessionId = Astro.cookies.get('session')?.value;
let isAuthenticated = false;
let userName = 'Guest';

if (sessionId) {
    const session = await SimpleAuthService.getSession(sessionId);
    if (session?.user) {
        isAuthenticated = true;
        userName = session.user.name || session.user.email || 'User';
    }
}

// Redirect to login if not authenticated
if (!isAuthenticated) {
    return Astro.redirect('/en/login');
}
---

<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Story Writer - Aquila</title>
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    </head>
    <body class="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-cyan-900">
        <div id="app" class="container mx-auto px-4 py-8">
            <!-- Header -->
            <header class="mb-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-4xl font-bold text-white mb-2">Story Writer</h1>
                        <p class="text-gray-300">Organize your stories, chapters, and scenes</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="text-white">Welcome, {userName}</span>
                        <a
                            href="/en"
                            class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors border border-white/20"
                        >
                            Back to Home
                        </a>
                    </div>
                </div>
            </header>

            <!-- Story Writer Component -->
            <div id="story-writer-root"></div>
        </div>

        <script>
            import StoryWriter from '@/components/StoryWriter.svelte';

            new StoryWriter({
                target: document.getElementById('story-writer-root')!,
            });
        </script>
    </body>
</html>
