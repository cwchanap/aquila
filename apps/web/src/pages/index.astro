---
import MainLayout from '@/layouts/main.astro';
import MainMenu from '@/components/MainMenu.svelte';
import { t as translate } from '@/lib/utils';

const locale = Astro.currentLocale || 'en';
const t = (key: string) => translate(locale, key);
---

<MainLayout title={t('menu.title')}>
    <MainMenu client:load locale={Astro.currentLocale ?? 'en'} />

    <script>
        // Handle language preference persistence
        document.addEventListener('DOMContentLoaded', () => {
            if (window.location.pathname === '/') {
                const savedLanguage = localStorage.getItem('aquila:language');

                if (savedLanguage === 'zh' && !window.location.pathname.startsWith('/zh')) {
                    window.location.href = '/zh';
                    return;
                }

                if (savedLanguage === 'en' && window.location.pathname.startsWith('/zh')) {
                    window.location.href = '/';
                }
            }
        });
    </script>
</MainLayout>