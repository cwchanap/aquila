---
import MainLayout from '@/layouts/main.astro';
import en from '../../../../translations/en.json';
import zh from '../../../../translations/zh.json';

// Helper function to get translations
const t = (key: string): string => {
  const locale = Astro.currentLocale || 'en';
  const keys = key.split('.');
  let value: Record<string, unknown> = locale === 'zh' ? zh : en;

  for (const k of keys) {
    if (value && typeof value === 'object' && k in value) {
      value = value[k] as Record<string, unknown>;
    } else {
      return key;
    }
  }

  return typeof value === 'string' ? value : key;
};
---

<MainLayout title={t("adventure.title")}>
  <div id="game-container" class="w-full h-screen bg-black"></div>
</MainLayout>

<script>
  import Phaser from 'phaser';
  import { EntryScene } from '@/game/EntryScene';

  document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const characterName = urlParams.get('name') || 'Player';

    const config = {
      type: Phaser.AUTO,
      width: window.innerWidth,
      height: window.innerHeight,
      parent: 'game-container',
      backgroundColor: '#2c3e50',
      scene: [EntryScene],
      scale: {
        mode: Phaser.Scale.RESIZE,
        autoCenter: Phaser.Scale.CENTER_BOTH
      }
    };

    const game = new Phaser.Game(config);
    
    // Pass character name to the entry scene
    game.scene.start('EntryScene', { characterName });
  });
</script>